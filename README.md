# Payment Server v1

κ°„λ‹¨ν• κ²°μ  μ„λ²„ μ‹μ¤ν…μΌλ΅, FastAPIμ™€ Streamlitμ„ μ‚¬μ©ν•μ—¬ κµ¬ν„λμ—μµλ‹λ‹¤.

## π€ μ£Όμ” κΈ°λ¥

- **κ²°μ  μ”μ²­ μƒμ„±**: μ£Όλ¬Έ IDμ™€ κΈμ•΅μ„ μ…λ ¥ν•μ—¬ κ²°μ  μ”μ²­ μƒμ„±
- **κ²°μ  ν™•μΈ**: λ€κΈ° μ¤‘μΈ κ²°μ λ¥Ό μλ™μΌλ΅ μ™„λ£ μ²λ¦¬
- **μλ™ λ§λ£**: 20μ΄ ν›„ λ€κΈ° μ¤‘μΈ κ²°μ  μλ™ μ κ±°
- **μ‹¤μ‹κ°„ ν„ν™©**: Streamlit μ›Ή μΈν„°νμ΄μ¤λ΅ κ²°μ  ν„ν™© μ‹¤μ‹κ°„ λ¨λ‹ν„°λ§
- **μƒνƒ μ¶”μ **: κ²°μ  μƒνƒλ³„ λ¶„λ¥ λ° ν†µκ³„ μ κ³µ

## π“ ν”„λ΅μ νΈ κµ¬μ΅°

```
payment-server/
β”β”€β”€ main.py              # FastAPI μ„λ²„ (v1)
β”β”€β”€ streamlit_app.py     # Streamlit μ›Ή μΈν„°νμ΄μ¤
β”β”€β”€ requirements.txt     # Python μμ΅΄μ„±
β”β”€β”€ Dockerfile          # Docker μ»¨ν…μ΄λ„ μ„¤μ •
β”β”€β”€ Dockerλ…λ Ήμ–΄.md     # Docker μ‚¬μ© κ°€μ΄λ“
β””β”€β”€ README.md           # ν”„λ΅μ νΈ λ¬Έμ„
```

## π› οΈ μ„¤μΉ λ° μ‹¤ν–‰

### 1. μμ΅΄μ„± μ„¤μΉ

```bash
pip install -r requirements.txt
```

### 2. μ„λ²„ μ‹¤ν–‰

```bash
# FastAPI μ„λ²„ μ‹¤ν–‰ (ν¬νΈ 9001)
python main.py

# λλ” uvicornμΌλ΅ μ‹¤ν–‰
uvicorn main:app --host 0.0.0.0 --port 9001 --reload
```

### 3. μ›Ή μΈν„°νμ΄μ¤ μ‹¤ν–‰

```bash
# Streamlit μ›Ή μΈν„°νμ΄μ¤ μ‹¤ν–‰ (ν¬νΈ 8501)
streamlit run streamlit_app.py
```

## π“΅ API μ—”λ“ν¬μΈνΈ

### κ²°μ  μ”μ²­
- **POST** `/pay`
  - κ²°μ  μ”μ²­μ„ μƒμ„±ν•κ³  λ€κΈ° μƒνƒλ΅ μ €μ¥
  - 20μ΄ ν›„ μλ™ λ§λ£

### κ²°μ  ν™•μΈ
- **POST** `/confirm-payment`
  - λ€κΈ° μ¤‘μΈ κ²°μ λ¥Ό μ™„λ£ μ²λ¦¬

### μƒνƒ μ΅°ν
- **GET** `/payment-status/{payment_id}`
  - νΉμ • κ²°μ μ μƒνƒ ν™•μΈ

- **GET** `/pending-payments`
  - λ¨λ“  κ²°μ  ν„ν™© μ΅°ν

### μ ν‹Έλ¦¬ν‹°
- **GET** `/healthz`
  - μ„λ²„ ν—¬μ¤ μ²΄ν¬

- **GET** `/debug/pending-payments`
  - λ””λ²„κΉ…μ© μƒμ„Έ μ •λ³΄

- **GET** `/expired-payments-info`
  - λ§λ£λ κ²°μ  μ •λ³΄ μ΅°ν

## π’³ κ²°μ  ν”λ΅μ°

1. **κ²°μ  μ”μ²­**: ν΄λΌμ΄μ–ΈνΈκ°€ μ£Όλ¬Έ IDμ™€ κΈμ•΅μΌλ΅ κ²°μ  μ”μ²­
2. **λ€κΈ° μƒνƒ**: κ²°μ κ°€ `PENDING` μƒνƒλ΅ μ €μ¥λ¨
3. **μλ™ ν™•μΈ**: κ΄€λ¦¬μκ°€ μ›Ή μΈν„°νμ΄μ¤μ—μ„ κ²°μ  μ™„λ£ λ²„νΌ ν΄λ¦­
4. **μ™„λ£ μ²λ¦¬**: κ²°μ  μƒνƒκ°€ `PAYMENT_COMPLETED`λ΅ λ³€κ²½
5. **μλ™ μ •λ¦¬**: 20μ΄ ν›„ λ―Έν™•μΈ κ²°μ λ” μλ™μΌλ΅ μ κ±°

## π”§ μ„¤μ •

### ν™κ²½ λ³€μ
- μ„λ²„ ν¬νΈ: κΈ°λ³Έκ°’ 9001
- μλ™ λ§λ£ μ‹κ°„: 20μ΄
- κ²°μ  λ°©μ‹: CARD (κ³ μ •)

### API μ„λ²„ URL
- κΈ°λ³Έκ°’: `http://localhost:9001`
- `streamlit_app.py`μ—μ„ `API_BASE_URL` λ³€μλ΅ μ„¤μ • κ°€λ¥

## π“ μ›Ή μΈν„°νμ΄μ¤ κΈ°λ¥

### λ©”μΈ ν™”λ©΄
- **κ²°μ  ν„ν™©**: λ€κΈ° μ¤‘/μ™„λ£λ κ²°μ  λ©λ΅
- **μƒ κ²°μ  μ”μ²­**: μ£Όλ¬Έ IDμ™€ κΈμ•΅ μ…λ ¥ νΌ
- **ν†µκ³„**: κ²°μ  μƒνƒλ³„ κ°μ λ° μ°¨νΈ

### μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ
- μƒλ΅κ³ μΉ¨ λ²„νΌμΌλ΅ μλ™ μ—…λ°μ΄νΈ
- κ²°μ  μ™„λ£ μ‹ μλ™ μƒλ΅κ³ μΉ¨
- ν•κµ­ μ‹κ°„(KST) ν‘μ‹

## π³ Docker μ§€μ›

### Dockerfile μ‚¬μ©
```bash
# μ΄λ―Έμ§€ λΉλ“
docker build -t payment-server-v1 .

# μ»¨ν…μ΄λ„ μ‹¤ν–‰
docker run -p 9001:9001 payment-server-v1
```

### Docker Compose (μ„ νƒμ‚¬ν•­)
```yaml
version: '3.8'
services:
  payment-server:
    build: .
    ports:
      - "9001:9001"
    environment:
      - PYTHONUNBUFFERED=1
```

## π” λ””λ²„κΉ…

### λ΅κ·Έ ν™•μΈ
- μ„λ²„ μ‹¤ν–‰ μ‹ μƒμ„Έν• λ΅κ·Έ μ¶λ ¥
- κ²°μ  μƒμ„±/ν™•μΈ/μ΅°ν κ³Όμ • μ¶”μ 
- μλ™ μ •λ¦¬ νƒμ¤ν¬ μƒνƒ λ¨λ‹ν„°λ§

### λ””λ²„κ·Έ μ—”λ“ν¬μΈνΈ
- `/debug/pending-payments`: λ‚΄λ¶€ λ°μ΄ν„° κµ¬μ΅° ν™•μΈ
- `/expired-payments-info`: λ§λ£ μμ •/λ§λ£λ κ²°μ  μ •λ³΄

## π“ λ°μ΄ν„° λ¨λΈ

### PaymentRequest
```json
{
  "order_id": "int",
  "payment_amount": "int"
}
```

### PaymentResponse
```json
{
  "payment_id": "string",
  "order_id": "int",
  "status": "PENDING|PAYMENT_COMPLETED|CANCELLED",
  "payment_amount": "int",
  "method": "string",
  "created_at": "string",
  "confirmed_at": "string|null"
}
```

## π¨ μ£Όμμ‚¬ν•­

- **λ©”λ¨λ¦¬ μ €μ¥**: κ²°μ  λ°μ΄ν„°λ” λ©”λ¨λ¦¬μ— μ €μ¥λλ―€λ΅ μ„λ²„ μ¬μ‹μ‘ μ‹ λ°μ΄ν„° μ†μ‹¤
- **μλ™ λ§λ£**: 20μ΄ ν›„ λ―Έν™•μΈ κ²°μ λ” μλ™μΌλ΅ μ κ±°λ¨
- **λ‹¨μΌ μΈμ¤ν„΄μ¤**: ν„μ¬ λ²„μ „μ€ λ‹¨μΌ μ„λ²„ μΈμ¤ν„΄μ¤μ—μ„λ§ λ™μ‘
- **μΈμ¦ μ—†μ**: ν„μ¬ λ²„μ „μ€ μΈμ¦/κ¶ν• κ΄€λ¦¬ κΈ°λ¥ μ—†μ

## π”„ μ—…κ·Έλ μ΄λ“ κ°€μ΄λ“

v1μ—μ„ v2λ΅ μ—…κ·Έλ μ΄λ“ν•λ ¤λ©΄:
1. `main2.py` (v2 μ„λ²„) μ‚¬μ©
2. `streamlit_app2.py` (v2 μ›Ή μΈν„°νμ΄μ¤) μ‚¬μ©
3. μ›Ήν›… κΈ°λ° κ²°μ  ν”λ΅μ°λ΅ μ „ν™

## π“ μ§€μ›

λ¬Έμ κ°€ λ°μƒν•κ±°λ‚ μ§λ¬Έμ΄ μμΌμ‹λ©΄ μ΄μλ¥Ό μƒμ„±ν•΄μ£Όμ„Έμ”.

---

**λ²„μ „**: v1.0.0  
**μµμΆ… μ—…λ°μ΄νΈ**: 2025-01-02  
**λΌμ΄μ„ μ¤**: MIT
